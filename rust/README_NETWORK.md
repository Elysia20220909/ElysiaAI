# Rust TCP/IP Stack Implementation

Rustã§ã‚¼ãƒ­ã‹ã‚‰å®Ÿè£…ã—ãŸè‡ªä½œTCP/IPã‚¹ã‚¿ãƒƒã‚¯ã€‚æ•™è‚²ç›®çš„ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã‚’ç›®çš„ã¨ã—ã¦ã„ã¾ã™ã€‚

## ğŸ¯ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ã€å®Œå…¨ã«è‡ªä½œã®TCP/IPãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¿ãƒƒã‚¯ã‚’Rustã§å®Ÿè£…ã—ãŸã‚‚ã®ã§ã™ã€‚OSIå‚ç…§ãƒ¢ãƒ‡ãƒ«ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼2ï¼ˆEthernetï¼‰ã‹ã‚‰ãƒ¬ã‚¤ãƒ¤ãƒ¼4ï¼ˆTCP/UDPï¼‰ã¾ã§ã‚’ã‚«ãƒãƒ¼ã—ã€Socket APIã‚’æä¾›ã—ã¾ã™ã€‚

## âœ¨ ä¸»ãªæ©Ÿèƒ½

### å®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½

- âœ… **Ethernetãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆLayer 2ï¼‰**
  - MACã‚¢ãƒ‰ãƒ¬ã‚¹å‡¦ç†
  - ãƒ•ãƒ¬ãƒ¼ãƒ ã®ãƒ‘ãƒ¼ã‚¹/ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
  - ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ/ãƒãƒ«ãƒã‚­ãƒ£ã‚¹ãƒˆæ¤œå‡º

- âœ… **IPãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆLayer 3ï¼‰**
  - IPv4ãƒ‘ã‚±ãƒƒãƒˆå‡¦ç†
  - ãƒã‚§ãƒƒã‚¯ã‚µãƒ è¨ˆç®—/æ¤œè¨¼
  - TTLç®¡ç†
  - ãƒ—ãƒ­ãƒˆã‚³ãƒ«è­˜åˆ¥

- âœ… **TCPãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆLayer 4ï¼‰**
  - ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ãƒ‘ãƒ¼ã‚¹/ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
  - ãƒ•ãƒ©ã‚°å‡¦ç†ï¼ˆSYN, ACK, FIN, etc.ï¼‰
  - æ¥ç¶šç®¡ç†
  - çŠ¶æ…‹ãƒã‚·ãƒ³

- âœ… **UDPãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼ˆLayer 4ï¼‰**
  - ãƒ‡ãƒ¼ã‚¿ã‚°ãƒ©ãƒ ã®ãƒ‘ãƒ¼ã‚¹/ã‚·ãƒªã‚¢ãƒ©ã‚¤ã‚º
  - ãƒã‚§ãƒƒã‚¯ã‚µãƒ è¨ˆç®—/æ¤œè¨¼

- âœ… **Socket API**
  - TCPã‚¹ãƒˆãƒªãƒ¼ãƒ ã‚½ã‚±ãƒƒãƒˆ
  - UDPãƒ‡ãƒ¼ã‚¿ã‚°ãƒ©ãƒ ã‚½ã‚±ãƒƒãƒˆ
  - bind/connect/listen/send/recvæ“ä½œ

- âœ… **ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒã‚¤ã‚¹æŠ½è±¡åŒ–**
  - TUN/TAPã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
  - ãƒ¢ãƒƒã‚¯ãƒ‡ãƒã‚¤ã‚¹ï¼ˆãƒ†ã‚¹ãƒˆç”¨ï¼‰

## ğŸ“ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
rust/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ network/
â”‚   â”‚   â”œâ”€â”€ mod.rs           # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©ã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”‚   â”‚   â”œâ”€â”€ ethernet.rs      # Ethernetãƒ•ãƒ¬ãƒ¼ãƒ å‡¦ç†
â”‚   â”‚   â”œâ”€â”€ ip.rs            # IPv4ãƒ‘ã‚±ãƒƒãƒˆå‡¦ç†
â”‚   â”‚   â”œâ”€â”€ tcp.rs           # TCPæ¥ç¶šç®¡ç†
â”‚   â”‚   â”œâ”€â”€ udp.rs           # UDPãƒ‡ãƒ¼ã‚¿ã‚°ãƒ©ãƒ å‡¦ç†
â”‚   â”‚   â”œâ”€â”€ socket.rs        # Socket APIå®Ÿè£…
â”‚   â”‚   â””â”€â”€ device.rs        # ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ‡ãƒã‚¤ã‚¹æŠ½è±¡åŒ–
â”‚   â”œâ”€â”€ lib.rs               # ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆ
â”‚   â””â”€â”€ ...                  # æ—¢å­˜ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ examples/
â”‚   â””â”€â”€ tcp_ip_demo.rs       # ãƒ‡ãƒ¢ãƒ—ãƒ­ã‚°ãƒ©ãƒ 
â”œâ”€â”€ tests/
â”‚   â””â”€â”€ network_integration_test.rs  # çµ±åˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ Cargo.toml               # ä¾å­˜é–¢ä¿‚ã¨è¨­å®š
â”œâ”€â”€ SETUP.md                 # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ README_TCPIP.md          # TCP/IPå®Ÿè£…è©³ç´°
â””â”€â”€ BUILD_PLATFORM.md        # ãƒ“ãƒ«ãƒ‰æƒ…å ±
```

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. Rustã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
# Windows
# https://www.rust-lang.org/tools/install ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰

# Linux/macOS
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

### 2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ“ãƒ«ãƒ‰

```bash
cd rust
cargo build --release
```

### 3. ãƒ‡ãƒ¢ã®å®Ÿè¡Œ

```bash
cargo run --example tcp_ip_demo
```

### 4. ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

```bash
cargo test
```

## ğŸ’» ä½¿ç”¨ä¾‹

### Ethernetãƒ•ãƒ¬ãƒ¼ãƒ ã®ä½œæˆ

```rust
use elysia_rust::network::ethernet::*;

let dst = MacAddress::new([0xff, 0xff, 0xff, 0xff, 0xff, 0xff]);
let src = MacAddress::new([0x00, 0x11, 0x22, 0x33, 0x44, 0x55]);
let payload = vec![0x01, 0x02, 0x03, 0x04];

let frame = EthernetFrame::new(dst, src, EtherType::Ipv4, payload);
let bytes = frame.serialize();
```

### IPv4ãƒ‘ã‚±ãƒƒãƒˆã®ä½œæˆã¨é€ä¿¡

```rust
use elysia_rust::network::ip::*;
use std::net::Ipv4Addr;

let src = Ipv4Addr::new(192, 168, 1, 100);
let dst = Ipv4Addr::new(8, 8, 8, 8);
let payload = vec![0x48, 0x65, 0x6C, 0x6C, 0x6F]; // "Hello"

let mut packet = Ipv4Packet::new(src, dst, IpProtocol::Tcp, payload);
let bytes = packet.serialize();
```

### TCPã‚½ã‚±ãƒƒãƒˆã®ä½¿ç”¨

```rust
use elysia_rust::network::{socket::*, tcp::*};
use std::sync::Arc;

let manager = Arc::new(TcpConnectionManager::new());
let mut socket = TcpSocket::new(manager);

let addr = SocketAddr::new(Ipv4Addr::new(0, 0, 0, 0), 8080);
socket.bind(addr)?;
socket.listen()?;
```

## ğŸ§ª ãƒ†ã‚¹ãƒˆ

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã«ã¯åŒ…æ‹¬çš„ãªãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ï¼š

```bash
# å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
cargo test

# ç‰¹å®šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ†ã‚¹ãƒˆ
cargo test network::ethernet
cargo test network::ip
cargo test network::tcp
```

### çµ±åˆãƒ†ã‚¹ãƒˆ

ãƒ•ãƒ«ã‚¹ã‚¿ãƒƒã‚¯ã®çµ±åˆãƒ†ã‚¹ãƒˆï¼š

```bash
cargo test --test network_integration_test
```

### ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

```bash
cargo tarpaulin --out Html
```

## ğŸ“Š ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
Application Layer
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    Socket API (Layer 5)   â”‚
â”‚  - TCP Socket             â”‚
â”‚  - UDP Socket             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TCP (Layer 4)    â”‚  UDP (Layer 4)â”‚
â”‚  - Connection     â”‚  - Stateless  â”‚
â”‚  - State Machine  â”‚  - Fast       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”
â”‚      IP Layer (Layer 3)           â”‚
â”‚  - Routing                        â”‚
â”‚  - Fragmentation                  â”‚
â”‚  - Checksum                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Ethernet Layer (Layer 2)        â”‚
â”‚  - Framing                        â”‚
â”‚  - MAC Addressing                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Network Device (Layer 1)        â”‚
â”‚  - TUN/TAP                        â”‚
â”‚  - Physical I/O                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“ å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

- [RFC 791 - Internet Protocol](https://tools.ietf.org/html/rfc791)
- [RFC 793 - Transmission Control Protocol](https://tools.ietf.org/html/rfc793)
- [RFC 768 - User Datagram Protocol](https://tools.ietf.org/html/rfc768)
- [Rust Book](https://doc.rust-lang.org/book/)
- [smoltcp - å‚è€ƒå®Ÿè£…](https://github.com/smoltcp-rs/smoltcp)

## ğŸ”§ æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

- **è¨€èª**: Rust 2021 Edition
- **ä¸»è¦ã‚¯ãƒ¬ãƒ¼ãƒˆ**:
  - `bytes` - ã‚¼ãƒ­ã‚³ãƒ”ãƒ¼ãƒãƒƒãƒ•ã‚¡ç®¡ç†
  - `tokio` - éåŒæœŸãƒ©ãƒ³ã‚¿ã‚¤ãƒ 
  - `pnet` - ãƒ‘ã‚±ãƒƒãƒˆå‡¦ç†ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  - `thiserror` - ã‚¨ãƒ©ãƒ¼å‡¦ç†

## ğŸš§ ãƒ­ãƒ¼ãƒ‰ãƒãƒƒãƒ—

### çŸ­æœŸç›®æ¨™
- [ ] ARP/RARPå®Ÿè£…
- [ ] ICMPå®Ÿè£…
- [ ] TCPå®Œå…¨ãªçŠ¶æ…‹ãƒã‚·ãƒ³
- [ ] å®Ÿéš›ã®TUN/TAP I/O

### ä¸­æœŸç›®æ¨™
- [ ] IPv6ã‚µãƒãƒ¼ãƒˆ
- [ ] TCPè¼»è¼³åˆ¶å¾¡ï¼ˆReno, CUBICï¼‰
- [ ] ãƒ‘ã‚±ãƒƒãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
- [ ] ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ†ãƒ¼ãƒ–ãƒ«

### é•·æœŸç›®æ¨™
- [ ] QoS/ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯åˆ¶å¾¡
- [ ] VPNæ©Ÿèƒ½
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯
- [ ] ãƒãƒ«ãƒã‚¹ãƒ¬ãƒƒãƒ‰æœ€é©åŒ–

## ğŸ“ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹

AGPL-3.0-or-later

## ğŸ¤ ã‚³ãƒ³ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³

ãƒ—ãƒ«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ­“è¿ã—ã¾ã™ï¼è©³ç´°ã¯[CONTRIBUTING.md](../../CONTRIBUTING.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

## ğŸ“§ é€£çµ¡å…ˆ

å•é¡Œã‚„è³ªå•ãŒã‚ã‚‹å ´åˆã¯ã€GitHubã®Issuesã§å ±å‘Šã—ã¦ãã ã•ã„ã€‚

---

**æ³¨æ„**: ã“ã®TCP/IPã‚¹ã‚¿ãƒƒã‚¯ã¯æ•™è‚²ç›®çš„ã¨ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å®Ÿé¨“ã®ãŸã‚ã«ä½œæˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç’°å¢ƒã§ã®ä½¿ç”¨ã«ã¯ã€ã•ã‚‰ãªã‚‹é–‹ç™ºã¨ãƒ†ã‚¹ãƒˆãŒå¿…è¦ã§ã™ã€‚
