(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=require("elysia"),r=require("fs");var n=e.n(r);const s=require("path");var a=e.n(s);const o=require("child_process"),c=new t.Elysia;c.get("/",()=>{const e=n().readFileSync(a().join(process.cwd(),"public","index.html"),"utf8");return new Response(e,{headers:{"content-type":"text/html; charset=utf-8"}})}),c.post("/ai",async e=>{const t=e.request,r=(t.headers.get("content-type")||"").toLowerCase();let n=[];try{if(r.includes("application/json")){const e=await t.json();n=e.messages??e}else if(r.includes("application/x-www-form-urlencoded")){const e=await t.text(),r=new URLSearchParams(e).get("messages");if(r)try{n=JSON.parse(r)}catch{n=[{role:"user",content:r}]}}else{const e=await t.text();try{const t=JSON.parse(e);n=t.messages??t}catch{e&&(n=[{role:"user",content:e}])}}}catch(e){return new Response(JSON.stringify({error:"invalid request body"}),{status:400,headers:{"content-type":"application/json; charset=utf-8"}})}const s=(((n.filter(e=>"user"===e.role).pop()??n.pop())||{content:""}).content||"").toString();if(!s.trim())return new Response(JSON.stringify({error:"empty prompt"}),{status:400,headers:{"content-type":"application/json; charset=utf-8"}});try{const e=(0,o.spawnSync)("ollama",["--version"],{encoding:"utf8"});if(e.error)throw e.error}catch(e){return new Response("Ollama CLI not found on server. Install Ollama and pull a model (e.g. `ollama pull llama3.2`).",{status:500})}try{const e=(0,o.spawnSync)("ollama",["run","llama3.2",s],{encoding:"utf8",maxBuffer:10485760});if(e.error)return new Response(`Failed to execute ollama: ${e.error.message}`,{status:500});if(0!==e.status){const t=e.stderr||String(e.status);return new Response(`Ollama returned non-zero status: ${t}`,{status:500})}const t=e.stdout??"";return new Response(t,{headers:{"content-type":"text/plain; charset=utf-8"}})}catch(e){return new Response(`Unexpected error running ollama: ${String(e?.message??e)}`,{status:500})}});const l=Number(process.env.PORT)||3e3;c.listen(l)})();