<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã‚¨ãƒªã‚·ã‚¢ã¡ã‚ƒã‚“â™¡ AI Chat</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/alpinejs@3.15.2/dist/cdn.min.js" defer></script>
    <style>
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        @keyframes gradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        @keyframes shimmer {
            0% { background-position: -1000px 0; }
            100% { background-position: 1000px 0; }
        }
        .animate-float {
            animation: float 3s ease-in-out infinite;
        }
        .animate-gradient {
            background-size: 200% 200%;
            animation: gradient 8s ease infinite;
        }
        .shimmer {
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            background-size: 1000px 100%;
            animation: shimmer 2s infinite;
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.8);
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        .message-enter {
            animation: slideIn 0.3s ease-out;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .scroll-smooth {
            scroll-behavior: smooth;
        }
        /* ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãƒãƒ¼ */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: rgba(236, 72, 153, 0.1);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, #ec4899, #a855f7);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(180deg, #db2777, #9333ea);
        }
    </style>
</head>
<body class="min-h-screen overflow-hidden animate-gradient bg-gradient-to-br from-pink-200 via-purple-200 via-blue-200 to-pink-200">
    <div class="container mx-auto px-4 py-6 h-screen flex flex-col max-w-6xl">
        <div class="glass-effect rounded-3xl shadow-2xl overflow-hidden flex flex-col h-full" x-data="_elysiaChat()">
            <!-- Header with Avatar -->
            <div class="relative bg-gradient-to-r from-pink-500 via-purple-400 to-pink-500 p-6 animate-gradient">
                <div class="flex items-center justify-center space-x-4">
                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center shadow-lg animate-float">
                        <span class="text-4xl">ğŸŒ¸</span>
                    </div>
                    <div class="text-center">
                        <h1 class="text-3xl font-bold text-white drop-shadow-lg">
                            ã‚¨ãƒªã‚·ã‚¢ã¡ã‚ƒã‚“ AI Chat â™¡
                        </h1>
                        <p class="text-white text-sm mt-1 opacity-90">
                            à¸…(ÕáŸ¸áŸ¸> á—œ <áŸ¸áŸ¸Õ)à¸… ãŠã«ã„ã¡ã‚ƒã‚“ã€ãŠè©±ã—ã—ã‚ˆã€œâ™ª
                        </p>
                    </div>
                </div>
                
                <!-- Status Indicators -->
                <div class="absolute top-4 right-4 flex space-x-2">
                    <div class="glass-effect px-3 py-1 rounded-full text-xs text-white flex items-center space-x-1">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>RAG</span>
                    </div>
                    <div class="glass-effect px-3 py-1 rounded-full text-xs text-white flex items-center space-x-1">
                        <div class="w-2 h-2 bg-green-400 rounded-full animate-pulse"></div>
                        <span>Ollama</span>
                    </div>
                </div>
            </div>

            <!-- Chat Messages -->
            <div class="flex-1 overflow-y-auto p-6 space-y-4 scroll-smooth bg-gradient-to-b from-pink-50 to-purple-50" id="chatContainer">
                <!-- Welcome Message -->
                <div class="flex justify-center mb-6" x-show="messages.length === 0">
                    <div class="glass-effect rounded-2xl px-6 py-4 max-w-md text-center shadow-lg">
                        <p class="text-pink-600 font-semibold text-lg mb-2">ã«ã‚ƒã‚“â™ª ã‚ˆã†ã“ãã€œâ™¡</p>
                        <p class="text-gray-600 text-sm">
                            ã‚¨ãƒªã‚·ã‚¢ã«ä½•ã§ã‚‚èã„ã¦ã­ï¼<br>
                            å„ªã—ãç­”ãˆã‚‹ã‹ã‚‰å®‰å¿ƒã—ã¦â™ª
                        </p>
                    </div>
                </div>

                <!-- Messages -->
                <template x-for="msg in messages" :key="msg.id">
                    <div :class="msg.role === 'user' ? 'flex justify-end' : 'flex justify-start'" class="message-enter">
                        <div :class="msg.role === 'user' 
                            ? 'bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl rounded-br-none px-5 py-3 max-w-md shadow-lg' 
                            : 'glass-effect text-gray-800 rounded-2xl rounded-bl-none px-5 py-3 max-w-2xl shadow-lg border-2 border-pink-300'">
                            
                            <!-- User Message -->
                            <template x-if="msg.role === 'user'">
                                <div class="flex items-start space-x-2">
                                    <span class="text-xl">ğŸ‘¤</span>
                                    <p class="text-sm whitespace-pre-wrap" x-text="msg.content"></p>
                                </div>
                            </template>
                            
                            <!-- Assistant Message -->
                            <template x-if="msg.role === 'assistant'">
                                <div class="flex items-start space-x-2">
                                    <span class="text-xl">ğŸ’•</span>
                                    <p class="text-sm whitespace-pre-wrap leading-relaxed" x-text="msg.content"></p>
                                </div>
                            </template>
                        </div>
                    </div>
                </template>
                
                <!-- Loading Indicator -->
                <template x-if="loading">
                    <div class="flex justify-start message-enter">
                        <div class="glass-effect rounded-2xl rounded-bl-none px-5 py-3 shadow-lg border-2 border-pink-300">
                            <div class="flex items-center space-x-3">
                                <span class="text-xl">ğŸ’•</span>
                                <div class="flex space-x-2">
                                    <div class="w-2 h-2 bg-pink-500 rounded-full animate-bounce"></div>
                                    <div class="w-2 h-2 bg-pink-500 rounded-full animate-bounce" style="animation-delay: 0.2s"></div>
                                    <div class="w-2 h-2 bg-pink-500 rounded-full animate-bounce" style="animation-delay: 0.4s"></div>
                                </div>
                                <span class="text-sm text-pink-600">è€ƒãˆä¸­...</span>
                            </div>
                        </div>
                    </div>
                </template>
            </div>

            <!-- Input Form -->
            <form @submit.prevent="sendMessage" class="p-4 bg-white border-t-2 border-pink-200">
                <div class="flex space-x-3">
                    <div class="flex-1 relative">
                        <input 
                            type="text" 
                            x-model="input"
                            :disabled="loading"
                            @keydown.enter="sendMessage"
                            placeholder="ã‚¨ãƒªã‚·ã‚¢ã¡ã‚ƒã‚“ã«è©±ã—ã‹ã‘ã¦ã­â™¡ ä½•ã§ã‚‚èã„ã¦ï¼"
                            class="w-full px-6 py-4 border-2 border-pink-300 rounded-full focus:outline-none focus:border-pink-500 focus:ring-4 focus:ring-pink-200 disabled:opacity-50 disabled:bg-gray-100 transition-all text-gray-700 placeholder-pink-300"
                        />
                        <div class="absolute right-4 top-1/2 transform -translate-y-1/2 text-pink-400">
                            <span x-show="!loading">âœ¨</span>
                        </div>
                    </div>
                    <button 
                        type="submit"
                        :disabled="loading || !input.trim()"
                        class="px-8 py-4 bg-gradient-to-r from-pink-500 to-purple-500 text-white font-bold rounded-full hover:from-pink-600 hover:to-purple-600 disabled:opacity-50 disabled:cursor-not-allowed transition-all shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95 flex items-center space-x-2"
                    >
                        <span>é€ä¿¡</span>
                        <span>ğŸ’Œ</span>
                    </button>
                </div>
                
                <!-- Quick Actions -->
                <div class="flex flex-wrap gap-2 mt-3 justify-center">
                    <button @click="setQuickMessage('ã“ã‚“ã«ã¡ã¯ï¼')" type="button" class="px-4 py-2 bg-pink-100 text-pink-600 rounded-full text-xs hover:bg-pink-200 transition-all">
                        ğŸ‘‹ æŒ¨æ‹¶
                    </button>
                    <button @click="setQuickMessage('ä»Šæ—¥ã®èª¿å­ã¯ã©ã†ï¼Ÿ')" type="button" class="px-4 py-2 bg-purple-100 text-purple-600 rounded-full text-xs hover:bg-purple-200 transition-all">
                        ğŸ’­ æ°—åˆ†
                    </button>
                    <button @click="setQuickMessage('é¢ç™½ã„è©±ã—ã¦ï¼')" type="button" class="px-4 py-2 bg-blue-100 text-blue-600 rounded-full text-xs hover:bg-blue-200 transition-all">
                        ğŸ­ é¢ç™½è©±
                    </button>
                    <button @click="setQuickMessage('ã‚¨ãƒªã‚·ã‚¢ã¡ã‚ƒã‚“ã®ã“ã¨æ•™ãˆã¦ï¼')" type="button" class="px-4 py-2 bg-pink-100 text-pink-600 rounded-full text-xs hover:bg-pink-200 transition-all">
                        âœ¨ è‡ªå·±ç´¹ä»‹
                    </button>
                </div>
            </form>
        </div>

        <!-- Info Panel -->
        <div class="mt-4 glass-effect rounded-2xl shadow-lg p-4 text-sm text-gray-700">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-2">
                    <span class="text-pink-500 font-bold">ğŸ’¡ ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±</span>
                </div>
                <div class="flex space-x-4 text-xs">
                    <span class="flex items-center space-x-1">
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>RAG API</span>
                    </span>
                    <span class="flex items-center space-x-1">
                        <span class="w-2 h-2 bg-green-500 rounded-full"></span>
                        <span>Ollama llama3.2</span>
                    </span>
                    <span class="flex items-center space-x-1">
                        <span>ğŸ“Š 50ã‚»ãƒªãƒ•å­¦ç¿’æ¸ˆã¿</span>
                    </span>
                </div>
            </div>
        </div>
    </div>

    <script>
        function _elysiaChat() {
            return {
                messages: [],
                input: '',
                loading: false,
                
                setQuickMessage(message) {
                    if (!this.loading) {
                        this.input = message;
                        this.$nextTick(() => {
                            this.sendMessage();
                        });
                    }
                },
                
                async sendMessage() {
                    if (!this.input.trim() || this.loading) return;
                    
                    const userMessage = this.input.trim();
                    this.messages.push({
                        id: Date.now(),
                        role: 'user',
                        content: userMessage
                    });
                    this.input = '';
                    this.loading = true;
                    
                    // Auto-scroll
                    this.$nextTick(() => {
                        const container = document.getElementById('chatContainer');
                        container.scrollTop = container.scrollHeight;
                    });
                    
                    try {
                        const response = await fetch('/elysia-love', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                messages: this.messages.map(m => ({
                                    role: m.role,
                                    content: m.content
                                }))
                            })
                        });
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const reader = response.body.getReader();
                        const decoder = new TextDecoder();
                        
                        const assistantMessage = {
                            id: Date.now() + 1,
                            role: 'assistant',
                            content: ''
                        };
                        this.messages.push(assistantMessage);
                        
                        while (true) {
                            const { done, value } = await reader.read();
                            if (done) break;
                            
                            const chunk = decoder.decode(value);
                            const lines = chunk.split('\n');
                            
                            for (const line of lines) {
                                if (line.startsWith('data: ')) {
                                    try {
                                        const data = JSON.parse(line.slice(6));
                                        if (data.content) {
                                            assistantMessage.content += data.content;
                                        }
                                    } catch (e) {
                                        // Skip invalid JSON
                                    }
                                }
                            }
                            
                            // Auto-scroll
                            this.$nextTick(() => {
                                const container = document.getElementById('chatContainer');
                                container.scrollTop = container.scrollHeight;
                            });
                        }
                    } catch (error) {
                        console.error('Error:', error);
                        this.messages.push({
                            id: Date.now() + 1,
                            role: 'assistant',
                            content: 'ã”ã‚ã‚“ã­ã€œâ™¡ ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¡ã‚ƒã£ãŸâ€¦ \n\nFastAPIã‚µãƒ¼ãƒãƒ¼ã¨OllamaãŒèµ·å‹•ã—ã¦ã‚‹ã‹ç¢ºèªã—ã¦ã­ï¼\n\nğŸ’¡ ç¢ºèªæ–¹æ³•:\n1. FastAPIã‚µãƒ¼ãƒãƒ¼: http://127.0.0.1:8000/health\n2. Ollama: ollama serve'
                        });
                    } finally {
                        this.loading = false;
                        
                        // Final auto-scroll
                        this.$nextTick(() => {
                            const container = document.getElementById('chatContainer');
                            container.scrollTop = container.scrollHeight;
                        });
                    }
                }
            }
        }
    </script>
</body>
</html>
